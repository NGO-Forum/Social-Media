<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Media Platforms</title>
    <link rel="shortcut icon" href="{{ url_for('static', filename='image/logo.png') }}" type="image/png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="../static/css/styles.css">

</head>

<body class="bg-gray-100 text-gray-800">

    <!-- Header -->
    <header class="bg-green-600 p-6 shadow-md">
        <div
            class="container mx-auto px-4 md:px-8 lg:px-20 grid grid-cols-1 md:grid-cols-5 items-center gap-4 md:gap-6">

            <!-- Logo -->
            <div class="flex justify-center md:justify-start mb-0 md:mb-0">
                <img src="{{ url_for('static', filename='image/NGO.png') }}" alt="NGO Forum Logo"
                    class="w-32 md:w-40 lg:w-48 h-auto">
            </div>

            <!-- Text Content -->
            <div class="md:col-span-4 text-center">
                <h1 class="text-lg sm:text-xl md:text-2xl lg:text-3xl font-extrabold text-white leading-snug">
                    The NGO Forum on Cambodia Media Platform
                </h1>
                <p class="text-green-100 mt-2 text-sm sm:text-base md:text-lg">
                    Post messages to multiple media platforms at once with a single click.
                </p>
            </div>

        </div>
    </header>

    <nav>
        <div class="bg-white shadow-md">
            <div class="container mx-auto px-4 md:px-12 lg:px-20">
                <ul class="flex space-x-4 md:space-x-6 lg:space-x-8 py-3">
                    <li>
                        <a href="{{ url_for('index') }}"
                            class="text-gray-700 hover:text-green-600 font-semibold {% if request.endpoint == 'index' %}border-b-2 border-green-600{% endif %}">Home</a>
                    </li>
                    <li>
                        <a href="{{ url_for('show_posts') }}"
                            class="text-gray-700 hover:text-green-600 font-semibold {% if request.endpoint == 'show_posts' %}border-b-2 border-green-600{% endif %}">All
                            Posts</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>


    <h1 class="text-2xl text-green-600 font-bold ml-6 mt-6">All Posts</h1>
    <main class="container mx-auto px-6 py-6 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8">

        {% for post in posts %}
        <button type="button" onclick="showPost({{ post.id }})"
            class="bg-white rounded-2xl shadow hover:shadow-xl transition overflow-hidden text-left">

            <!-- Cover Image -->
            {% if post.images %}
            <img src="{{ url_for('uploaded_file', filename=post.images.split(',')[0] | basename) }}"
                class="w-full h-56 object-cover">
            {% endif %}

            <!-- Text -->
            <div class="p-5">
                <p class="text-gray-400 text-sm mb-2">
                    {{ post.created_at.strftime('%B %d, %Y') }}
                </p>

                <h2 class="font-bold text-lg mb-3 line-clamp-2">
                    {{ post.title }}
                </h2>

                <p class="text-gray-600 text-sm line-clamp-3">
                    {{ post.description }}
                </p>

                <div class="mt-4 flex items-center gap-2 text-green-600 font-semibold">
                    Read More
                    <i class="fa-solid fa-arrow-up-right-from-square"></i>
                </div>
            </div>
        </button>
        {% endfor %}

    </main>

    <script>
        function showPost(id) {
            fetch(`/api/posts/${id}`)
                .then(res => res.json())
                .then(post => {

                    let images = post.images || [];
                    let index = 0;

                    function renderImage() {
                        if (!images.length) return '';

                        let arrows = '';
                        if (images.length > 1) {
                            arrows = `
                        <button onclick="prevImg()"
                            class="absolute left-3 top-1/2 -translate-y-1/2
                                   bg-white/80 w-9 h-9 rounded-full text-xl">‹</button>
                        <button onclick="nextImg()"
                            class="absolute right-3 top-1/2 -translate-y-1/2
                                   bg-white/80 w-9 h-9 rounded-full text-xl">›</button>
                    `;
                        }

                        return `
                    <div class="relative">
                        <img src="/uploads/${images[index].split('/').pop()}"
                             class="w-full max-h-[420px] object-cover rounded-xl">
                        ${arrows}
                    </div>
                `;
                    }

                    function modalHtml() {
                        return `
                    ${renderImage()}
                    <p class="text-sm text-gray-400 mt-4 mb-3">${post.created_at}</p>
                    <div class="text-left text-gray-700 leading-relaxed whitespace-pre-line">
                        ${post.description}
                    </div>
                `;
                    }

                    window.prevImg = function () {
                        index = (index - 1 + images.length) % images.length;
                        Swal.update({ html: modalHtml() });
                    };

                    window.nextImg = function () {
                        index = (index + 1) % images.length;
                        Swal.update({ html: modalHtml() });
                    };

                    Swal.fire({
                        title: post.title,
                        html: modalHtml(),
                        width: 900,
                        showCloseButton: true,
                        showConfirmButton: false,
                        customClass: {
                            popup: 'rounded-2xl'
                        }
                    });
                })
                .catch(err => {
                    console.error(err);
                    Swal.fire("Error", "Failed to load post", "error");
                });
        }
    </script>


</body>

</html>